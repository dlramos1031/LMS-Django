{% extends "dashboard/dashboard_base.html" %}
{% load static %}
{% load bootstrap5 %}

{% block dashboard_title %}Manage Books{% endblock dashboard_title %}

{% block dashboard_content %}
<div class="d-flex justify-content-between align-items-center mb-3 pt-3">
  <h5 class="mb-0 text-secondary">Manage Books</h5>
  {# Search Form specific to books tab #}
  <form method="get" class="d-flex" style="gap: 0.5rem;">
    <input type="hidden" name="tab" value="books"> {# Keep track of the current tab #}
    <input type="text" name="search" class="form-control form-control-sm"
           placeholder="Search title, author, genre..."
           value="{{ search_term|default:'' }}" {# Use search_term from context #}
           style="width: 250px;">
    <button class="btn btn-sm btn-outline-primary" type="submit">
      <i class="bi bi-search"></i> Search {# Example using Bootstrap Icons #}
    </button>
  </form>
</div>

{# Books Table - Added more columns #}
<div class="table-responsive">
  <table class="table table-sm table-bordered table-hover align-middle">
    <thead class="table-light">
      <tr>
        <th>Title</th>
        <th>Authors</th>
        <th>Genres</th> 
        <th>Quantity</th>
        <th class="text-center">Actions</th>
      </tr>
    </thead>
    <tbody>
      {% for book in page_obj %} 
      <tr>
        <td>
            {% if book.cover_image %}
               <img src="{{ book.cover_image.url }}" alt="" width="30" height="45" class="me-2 rounded object-fit-cover">
            {% else %}
               <span class="d-inline-block bg-light border me-2" style="width: 30px; height: 45px; vertical-align: middle;"></span>
            {% endif %}
            <a href="{% url 'book_detail' book.id %}">{{ book.title }}</a>
        </td>
        <td>
          {# Display authors concisely #}
          {{ book.authors.all|join:", " }}
        </td>
         <td>{{ book.genres.all|join:", " }}</td>
        <td>{{ book.quantity }}</td>
        <td class="text-center">
          {# Action Buttons triggering modals #}
          <button class="btn btn-sm btn-outline-secondary me-1" data-bs-toggle="modal" data-bs-target="#editBookModal-{{ book.id }}" title="Edit {{ book.title }}">
              <i class="bi bi-pencil-square"></i> Edit
          </button>
          <button class="btn btn-sm btn-outline-danger" data-bs-toggle="modal" data-bs-target="#deleteBookModal-{{ book.id }}" title="Delete {{ book.title }}">
              <i class="bi bi-trash"></i> Delete
          </button>

          {# Edit Book Modal #}
          {% include 'books/includes/dashboard/_edit_book_modal.html' with book=book %}

          {# Delete Book Modal (Unique ID per book) #}
          {% include 'books/includes/dashboard/_delete_book_modal.html' with book=book %}
          
        </td>
      </tr>
      {% empty %}
      <tr>
        <td colspan="6" class="text-center text-muted">
          {% if search_term %}
            No books found matching your search criteria.
          {% else %}
            No books in the catalog yet. Add one below!
          {% endif %}
        </td>
      </tr>
      {% endfor %}
    </tbody>
  </table>
</div> {# End .table-responsive #}

{# Add Book Button #}
<div class="text-end mb-4">
  <button class="btn btn-sm btn-success" data-bs-toggle="modal" data-bs-target="#addBookModal">
    <i class="bi bi-plus-circle"></i> Add New Book
  </button>
</div>

{# Add Book Modal #}
{% block modals %}
    {% include 'books/includes/dashboard/_add_book_modal.html' %}
{% endblock modals %}

{% include "books/includes/pagination.html" with page_obj=page_obj %}
{% endblock dashboard_content %}
