{% extends "dashboard/dashboard_base.html" %}
{% load static %}
{% load bootstrap5 %}

{% block dashboard_title %}Pending Requests{% endblock dashboard_title %}

{% block dashboard_content %}
<div class="d-flex justify-content-between align-items-center mb-3 pt-3">
  <h5 class="mb-0 text-secondary">Pending Borrow Requests</h5>
  {# Search Form #}
  <form method="get" class="d-flex" style="gap: 0.5rem;">
    <input type="hidden" name="tab" value="pending"> {# Correct tab value #}
    <input type="text" name="search" class="form-control form-control-sm"
           placeholder="Search book or user..."
           value="{{ search_term|default:'' }}"
           style="width: 250px;">
    <button class="btn btn-sm btn-outline-primary" type="submit">
      <i class="bi bi-search"></i> Search
    </button>
  </form>
</div>
{# Pending Borrowings Table #}
<div class="table-responsive">
  <table class="table table-sm table-bordered table-hover align-middle">
    <thead class="table-light">
      <tr>
        <th>User</th>
        <th>Book</th>
        <th>Requested</th>
        <th>Due Date</th>
        <th class="text-center">Actions</th>
      </tr>
    </thead>
    <tbody>
      {% for borrow in page_obj %} 
      <tr>
        <td>
          <a href="{% url 'user_profile' borrow.user.id %}">{{ borrow.user.username }}</a>
        </td>
        <td>
          <a href="{% url 'user_profile' borrow.book.id %}">{{ borrow.book.title }}</a>
        </td>
        <td>{{ borrow.borrow_date|date:"Y-m-d H:i" }}</td>
        <td>{{ borrow.due_date|date:"Y-m-d" }}</td>
        <td class="text-center">
          {# Approve Form #}
          <form method="post" action="{% url 'approve_borrow' borrow.id %}" class="d-inline me-1">
            {% csrf_token %}
            <button type="submit" class="btn btn-success btn-sm" title="Approve Request">
               <i class="bi bi-check-lg"></i> Approve
            </button>
          </form>
          {# Reject Form #}
          <form method="post" action="{% url 'reject_borrow' borrow.id %}" class="d-inline">
            {% csrf_token %}
            <button type="submit" class="btn btn-danger btn-sm" title="Reject Request">
               <i class="bi bi-x-lg"></i> Reject
            </button>
          </form>
        </td>
      </tr>
      {% empty %}
      <tr>
        <td colspan="5" class="text-center text-muted">
          {% if search_term %}
            No pending requests found matching your search.
          {% else %}
            No pending requests.
          {% endif %}
        </td>
      </tr>
      {% endfor %}
    </tbody>
  </table>
</div>
{% include "books/includes/pagination.html" with page_obj=page_obj %}
{% endblock dashboard_content %}